var stylus = require('stylus')
var fs = require('fs')

module.exports = function (path) {
  return new Promise(function (resolve, reject) {
    stylus(fs.readFileSync(path, 'utf8'))
      .set('filename', path, 'utf8')
      .render(function (err, css) {
        if (err) {
          reject(err)
          return
        }
        if (document == null) {
          console.error('document object is missing: Use this module in HTML file.')
          reject({error: 'document object is missing'})
          return
        }

        if (document.head == null) {
          console.error('head element is missing: Place <head> tag in your HTML file.')
          reject({error: 'head element is missing'})
          return
        }

        var style = document.createElement('style')
        style.innerText = css
        style.type = 'text/css'
        document.head.appendChild(style)

        resolve(css)
      })
  })
}
